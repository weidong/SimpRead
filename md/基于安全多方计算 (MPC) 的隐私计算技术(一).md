> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [zhuanlan.zhihu.com](https://zhuanlan.zhihu.com/p/259259602) ![](https://pic3.zhimg.com/v2-07163fbbabe57b02d044fd654871ea06_r.jpg)

前面文章讲到了通过**[可信执行环境 (TEE，Trusted Execution Environment)](https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzg2MDA2NzQwNw%3D%3D%26mid%3D2247483772%26idx%3D1%26sn%3D461183928849488e1ca174c94d36b29b%26chksm%3Dce2d425cf95acb4adc154e929abf8ee51425a4540470fe255854769f49cb78437e75bb75d0f7%26scene%3D21%23wechat_redirect)** 技术可以达到隐私计算的目的。

TEE 是通过硬件的方式保护参与计算数据的隐私性，但基于 TEE 的隐私计算并不是建立在参与方间完全无信任环境下的，实际上会有一个各参与方都认可的可信根，一般而言，这个可信根是 TEE 的制造厂商。

现在比较成熟的 TEE 技术就是英特尔的 SGX，如果是通过 SGX 做隐私计算，由于要去英特尔的服务器上做远程认证，则需要各个参与方都信任英特尔。因此基于 TEE 的隐私计算对于某些安全性要求更高场景并不适用。

除了基于 TEE 的隐私计算外，安全多方计算技术（MPC 或 SMPC，Secure multi-party computation）也可以做隐私计算。安全多方计算技术则是基于密码学的多种技术纯软件实现的隐私计算。各参与方之间无需可信根，更加安全。但由于包含了复杂的密码学操作，相较于基于 TEE 的隐私计算而言，效率会低一些。

**安全多方计算简介**
------------

安全多方计算是指在无可信第三方的情况下，多个参与方协同计算一个约定的函数，并且保证每一方仅获取自己的计算结果，无法通过计算过程中的交互数据推测出其他任意一方的输入和输出数据（除非函数本身可以由自己的输入推测出其他参与方的输入和输出）。

安全多方计算可抽象概括为数学模型，其公式如下：

![](https://pic1.zhimg.com/v2-34ad1c4a65c55cc0fb4f06d1fe0f375c_r.jpg)

安全多方计算于 1986 年由姚期智院士通过姚氏百万富翁问题提出：两个百万富翁街头邂逅，他们都想炫一下富，比一比谁更有钱，但是出于隐私，都不想让对方知道自己到底拥有多少财富，如何在不借助第三方的情况下，让他们知道谁更有钱。姚氏 “百万富翁问题” 后经发展，成为现代密码学中非常活跃的研究领域，即安全多方计算。

**安全多方计算组成**
------------

安全多方计算技术并不是一个单一的技术，它本身是由一些列技术组成的协议栈。按层次可为 2 层，如下图所示：

![](https://pic4.zhimg.com/v2-dd7ea1ac3b56d55f0246af0454567ee3_r.jpg)

**支撑技术层**

支撑技术层提供构建 MPC 的基础技术实现，包含常用的加密解密、hash 函数、密钥交换、同态加密（HE，Homomorphic Encryption）、伪随机函数等，还包含 MPC 中的基础工具：秘密分享（SS，Secret Sharing）、不经意传输协议 (OT，Oblivious Transfer)、不经意为随机函数（OPRF，Oblivious Pseudorandom Function）等；

**具体 MPC 算法层**

具体 MPC 算法是利用支撑技术组合构造的 MPC 协议。

构造的 MPC 协议又分为两大类，专用算法和通用框架。

**专用算法**是指为解决特定问题所构造出的特殊 MPC 协议，由于是针对性构造并进行优化，专用算法的效率会比基于混淆电路（GC ，Garbled Circuit）的通用框架高很多，包含四则运算，比较运算，矩阵运算，隐私集合求交集，隐私数据查询，差分隐私等等；

**通用框架**是指可以满足大部分计算逻辑的通用 MPC 协议，主要基于混淆电路实现，可将计算逻辑编译成电路，然后混淆执行，支持大部分计算逻辑，但对于复杂计算逻辑，混淆电路的效率会有不同程度的降低。

专用算法和通用框架是解决隐私计算问题的两种不同思路，专用算法为特定隐私计算逻辑设计，效率更高，但只能支持单一计算逻辑；通用框架可以支持大部分隐私计算逻辑，由于支持更多的计算逻辑，与专用算法相比效率会有很大的差距（约 10~100 倍）。

**安全多方计算基础技术**

### **秘密分享**

秘密分享（SS，Secret Sharing）是指数据拆散成多个无意义的数，并将这些数分发到多个参与方那里。每个参与方拿到的都是原始数据的一部分，一个或少数几个参与方无法还原出原始数据，只有把各自的数据凑在一起时才能还原出真实数据。

秘密分享的一种经典方案，1979 年 Shamir 提出了阈值秘密分享方案，该方案支持 n 个参与方中的任意 t 个可以联合解开秘密数据，具体方案如下：

![](https://pic2.zhimg.com/v2-a516b6eee3834087e32f60092935f279_r.jpg)

秘密分享技术本身可以直接构造安全多方计算协议，在计算时，各参与方将自己的输入数据通过秘密分享的方式将数据的分片分发到各参与方，各参与方用自己收到的每个数据分片进行计算，并且在适当的时候交换一些数据（交换的数据本身看起来也是随机的，不包含关于原始数据的信息），将计算结束后的结果发到发起方，发起方将所有参与方返回的结果进行聚合。

通过基于数据分片进行计算，可以保护每个参与方的输入，但在最后聚合时，可以还原出真实的计算结果。

Shamir 的阈值秘密分享是线性的，即满足加法同态，因此可以通过该方案实现多方加法运算。接下来介绍通过 Shamir 的阈值秘密分享三方求和。

假设三方 A，B，C 分别有数据 a，b，c，有数据需求方想要计算 a+b+c。

![](https://pic4.zhimg.com/v2-bbe29bf22818ed2501a3e4a8a17a6e9b_r.jpg)

**不经意传输**

不经意传输 (OT，Oblivious Transfer) 是指数据发送方有 n 个数据，数据接收方接收其中的一个数据，且数据接收方不能获取其他的数据，数据发送方不知道接收方选择接收的数据具体是哪一个。

接下来介绍 “2 选 1” 的 OT 方案：

![](https://pic2.zhimg.com/v2-e11727970a7142687698846a6385ae59_r.jpg)![](https://pic4.zhimg.com/v2-67d5850083e54e68e52ff1b52d563f5b_r.jpg)

**混淆电路**

混淆电路（GC，Garbled Circuit）是指将一参与方安全多方计算协议的计算逻辑编译成布尔电路，然后将布尔电路中的每一个门进行加密并打乱加密顺序完成混淆操作。

完成混淆后，该参与方将加密电路以及与其输入相关的标签（另一方无法从标签中反推输入的信息）发送给另一参与方。另一方（作为接收方）通过不经意传输 (OT) 按照其输入选取标签，并在此基础上对混淆电路进行解密获取计算结果。

假设两个参与方 A 和 B 的输入分别是 x（0），y（1），计算逻辑是与门

![](https://pic3.zhimg.com/v2-07163fbbabe57b02d044fd654871ea06_r.jpg)![](https://pic4.zhimg.com/v2-2f52a64cb196c87f9ad59321311b0cbb_r.jpg)

真值表  

![](https://pic1.zhimg.com/v2-47b0e41bff25d2c93ce04ff52173c11c_r.jpg)![](https://pic4.zhimg.com/v2-c32e4e1c82b6151fcbe5527081595e53_r.jpg)

加密后真值表

整个过程中通过 OT 协议，A 无法感知 B 的输入，通过加密输出并打乱顺序，B 无法知道 A 的输入。

由于大部分计算逻辑都可以表示成布尔电路或算术电路，因此基于混淆电路技术可以构造出通用的安全多方计算协议。

### **同态加密**

同态加密（HE，Homomorphic Encryption）是指对密文计算后的结果再解密和直接对明文计算的结果一致，同态加密按照其满足的运算类型可分为加法同态（Paillier 同态加密），乘法同态（RSA 同态加密），以及加法乘法都满足的全同态加密（Gentry 同态加密）。

通过同态加密也可以直接构造安全多方计算协议。每个参与方的输入数据都通过同态加密后发送给计算方，计算方在本地基于密文进行计算，将计算结果返回各需求方并解密获得真实的计算结果。由于各参与方的输入都是加密后进行计算，可以保证各参与方输入的隐私性。

接下来介绍一种通过 Paillier 加法同态实现三方加法的方案。

假设两方 A，B，C 分别有数据 a，b，c，有数据需求方想要获取 a+b+c。

1. 数据需求方基于 Paillier 算法生成公私钥对（Pk，Sk），并将 Pk 发给 A，B，C。

2. A，B，C 分别使用收到的公钥加密 a，b，c。然后 B，C 分别将 Enc(b)， Enc(c) 发送给 A。

3. A 收到 Enc(b)，Enc(c) 后计算 Enc(a)+Enc(b)+Enc(c)= Enc(a+b+c)，并将计算后的结果发送给数据需求方。

4. 数据需求方解密收到的数据，获取 a+b+c。

Dec(Enc(a)+Enc(b)+Enc(c))=Dec(Enc(a+b+c))=a+b+c

### **总结**

本文介绍了安全多方计算的整体技术体系以及用于构造安全多方计算协议的基础技术。

通过安全多方计算技术可以很好的解决各机构间不愿共享数据，不敢共享数据的问题，在保证各方数据安全的前提下，进行多方数据的联合计算，可以在一定程度上打消各机构共享私密数据的顾虑，愿意共享出自己的数据，联合挖掘数据价值，拓宽数据的使用维度。

**作者简介**刘敬数据网格实验室算法工程师致力于研究 MPC 通用和专用算法
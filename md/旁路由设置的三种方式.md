> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [oeone.cn](https://oeone.cn/archives/486.html)

前言
--

相信大家基本都会设置旁路由，但是由于市面上各种旁路由设置教程都不全面且鱼龙混杂，所以刚开始看见的人基本都一脸懵逼，为了让大家在捡垃圾的时候没有后顾之忧，从今天开始，我会更新一系列教程教大家完美设置网络设备。

正文
--

![](https://oeone.cn/img/pangluyou.png)

### 首先默认主路由和旁路由为以下情况：

<table><thead><tr><th><strong>主路由：</strong></th><th><strong>旁路由：</strong></th></tr></thead><tbody><tr><td>IP：192.168.11.1</td><td>IP：192.168.1.1</td></tr><tr><td>子网掩码：255.255.255.0</td><td>子网掩码：默认</td></tr><tr><td>网关：默认</td><td>网关：默认</td></tr><tr><td>广播：默认</td><td>广播：默认</td></tr><tr><td>自定义 DNS 服务器：默认</td><td>自定义 DNS 服务器：默认</td></tr></tbody></table>

### 模式一：主路由 开 DHCP + 旁路由 关 DHCP （非全局）

主路由无需做任何变动。

旁路由：

IPv4 地址修改为主路由网段中的一个地址，例如 192.168.11.3。

子网掩码设置与主路由相同，例如 255.255.225.0。

网关设置为主路由地址，例如 192.168.11.1。

DNS 地址根据本地网络情况设置，推荐设置为主路由 IP，例如 192.168.11.1。

**重要：若将 DNS 加速功能放在旁路由上，则统一将旁路由的 DNS 服务器设置为 127.0.0.1。**

同时下方「DHCP 服务器」，勾选「忽略此接口」。

保存并应用配置，然后将 旁路由 连接到主路由的 LAN 口。

表现如下：

<table><thead><tr><th><strong>主路由：</strong></th><th><strong>旁路由：</strong></th></tr></thead><tbody><tr><td>IP：192.168.11.1</td><td>IP：192.168.11.3</td></tr><tr><td>子网掩码：255.255.255.0</td><td>子网掩码：255.255.255.0</td></tr><tr><td>网关：默认</td><td>网关：192.168.11.1</td></tr><tr><td>广播：默认</td><td>广播：默认</td></tr><tr><td>自定义 DNS 服务器：默认</td><td>自定义 DNS 服务器：192.168.11.1</td></tr></tbody></table>

局域网内所有设置，需要手动指定需要 旁路由 服务的设备，网关地址和 DNS 服务器为 192.168.11.3。

### 模式二：主路由开 DHCP + 旁路由 关 DHCP (全局)

#### 方法一：

旁路由的设置与模式一相同。

进入主路由，将主路由的 DHCP 的默认网关修改为旁路由的 IP，例如 192.168.11.3， DNS 服务器也修改为旁路由的 IP，例如 192.168.11.3。

#### 方法二（适用于主路由为 Openwrt）：

旁路由的设置与模式一相同。

在主路由「DHCP 选项」中，添加两条参数，3,192.168.11.3，6,192.168.11.3 。

保存并应用配置即可。

表现如下：

<table><thead><tr><th><strong>主路由：</strong></th><th><strong>旁路由：</strong></th></tr></thead><tbody><tr><td>IP：192.168.11.1</td><td>IP：192.168.11.3</td></tr><tr><td>子网掩码：255.255.255.0</td><td>子网掩码：255.255.255.0</td></tr><tr><td>网关：192.168.11.3</td><td>网关：192.168.11.1</td></tr><tr><td>广播：默认</td><td>广播：默认</td></tr><tr><td>自定义 DNS 服务器：192.168.11.3</td><td>自定义 DNS 服务器：192.168.11.1</td></tr></tbody></table>

### 模式三：主路由不开 DHCP+ 旁路由 开 DHCP (全局)

主路由关闭 DHCP，然后设置网关为旁路由的 IP，例如 192.168.11.3， DNS 服务器也修改为旁路由的 IP，例如 192.168.11.3。

旁路由设置网关为主路由的 IP，例如 192.168.11.1。

**可选：旁路由设置 DNS 服务器为主路由的 IP，例如 192.168.11.1。**

表现如下：

<table><thead><tr><th><strong>主路由：</strong></th><th><strong>旁路由：</strong></th></tr></thead><tbody><tr><td>IP：192.168.11.1</td><td>IP：192.168.11.3</td></tr><tr><td>子网掩码：255.255.255.0</td><td>子网掩码：255.255.255.0</td></tr><tr><td>网关：192.168.11.3</td><td>网关：192.168.11.1</td></tr><tr><td>广播：默认</td><td>广播：默认</td></tr><tr><td>自定义 DNS 服务器：192.168.11.3</td><td>自定义 DNS 服务器：默认（或者 192.168.11.1）</td></tr></tbody></table>

### 附一：

N1 盒子旁路由需要在防火墙自定义规则添加：

iptables -t nat -I POSTROUTING -o eth0 -j MASQUERADE

作者：OEONE

更新时间：2020 年 03 月 13 日